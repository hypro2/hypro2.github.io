---
layout: post
title: ëª¨ë¸ ë¦¬ë·° ë¯¹ìŠ¤íŠ¸ë„ 8x22B 4bitë¥¼ H100ì—ì„œ êµ¬ë™ í•´ë³´ì
---

ë¯¸ìŠ¤íŠ¸ë„ AIê°€ ìµœì‹  ì˜¤í”ˆì†ŒìŠ¤ LLMì¸ 'ë¯¹ìŠ¤íŠ¸ë„ 8x22B'ë¥¼ ê³µê°œí–ˆìŠµë‹ˆë‹¤! ğŸ˜Š

ì´ ëª¨ë¸ì€ ë©”íƒ€ì˜ 'ë¼ë§ˆ 2 70B'ì™€ ì˜¤í”ˆAIì˜ 'GPT-3.5'ì™€ ë¹„ìŠ·í•œ ì„±ëŠ¥ì„ ìë‘í•´í•˜ê³  ìˆìŠµë‹ˆë‹¤. ë˜í•œ, ì´ ëª¨ë¸ì€ 6ë§Œ5000ê°œì˜ í† í° ì»¨í…ìŠ¤íŠ¸ ì°½ê³¼ ìµœëŒ€ 1760ì–µ ê°œì˜ ë§¤ê°œë³€ìˆ˜ë¥¼ ê°€ì§€ê³  ìˆì–´ì„œ, ì´ë¥¼ ìœ„í•´ 'í¬ì†Œ ì „ë¬¸ê°€ í˜¼í•©(SMoE)' ì ‘ê·¼ ë°©ì‹ì„ ì‚¬ìš©í•˜ì—¬ ì‹¤í–‰ ë¹„ìš©ê³¼ ì‹œê°„ì„ í¬ê²Œ ì¤„ì˜€ìŠµë‹ˆë‹¤.



ë¯¹ìŠ¤íŠ¸ë„ 8x22BëŠ” 220ì–µ ê°œì˜ ë§¤ê°œë³€ìˆ˜ë¥¼ ê°€ì§„ 8ê°œì˜ ì „ë¬¸ ëª¨ë¸ë¡œ êµ¬ì„±ë˜ì–´ ìˆê³ , ê° í† í°ë‹¹ 2ê°œì˜ ì „ë¬¸ ëª¨ë¸ì„ í• ë‹¹í•˜ì—¬ ì…ë ¥ì„ ì²˜ë¦¬í•˜ê³  ì¶œë ¥ì„ ìƒì„±í•œë‹¤ê³  í•©ë‹ˆë‹¤. ğŸ¤–âœ¨

í—ˆê¹…í˜ì´ìŠ¤ì— ë“¤ì–´ê°€ì„œ ëª¨ë¸ì„ ë‹¤ìš´ ë°›ì•„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. H100ì„ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ì„œ 4bitë¡œ êµ¬ë™ í•´ë´¤ìŠµë‹ˆë‹¤. 4bitì§€ë§Œ ì†ë„ê°€ ê´œì°®ê²Œ ë‚˜ì˜¤ëŠ” ê±° ê°™ìŠµë‹ˆë‹¤. 80GB 1ì¥ì—ì„œ ëŒë¦´ ìˆ˜ ìˆëŠ”Â  ì•„ì£¼ ê°•ë ¥í•œ LLM ëª¨ë¸ì´ ë‚˜ì˜¨ ê²ƒì´ í™•ì‹¤í•œê±° ê°™ìŠµë‹ˆë‹¤. GPU ì‚¬ìš©ëŸ‰ì´ 70GBì´ìƒ íŒŒì¸íŠœë‹ì„ í•˜ê¸°ëŠ” ê°œì¸ ê·œëª¨ì—ì„œëŠ” ì–´ë ¤ìš¸ê±°ë¡œ ì˜ˆìƒë©ë‹ˆë‹¤.Â Â 

[https://huggingface.co/mistral-community/Mixtral-8x22B-v0.1](https://huggingface.co/mistral-community/Mixtral-8x22B-v0.1)
![image](https://github.com/hypro2/hypro2.github.io/assets/84513149/1d6ef7be-7cd7-4b56-b278-d0ba4124e73c)


```
from transformers import AutoModelForCausalLM, AutoTokenizer

model_id = "./Mixtral-8x22B-v0.1-4bit"
tokenizer = AutoTokenizer.from_pretrained(model_id)

model = AutoModelForCausalLM.from_pretrained(model_id)

text = "Who is Einstein?"
inputs = tokenizer(text, return_tensors="pt")

outputs = model.generate(**inputs, max_new_tokens=20)
print(tokenizer.decode(outputs[0], skip_special_tokens=True))
```

Who is Einstein?  
Einstein was a German-born theoretical physicist. He developed the general theory of relativity, one of two pillars in modern physics (alongside quantum mechanics). His work has also been used to develop nuclear weapons and energy production through his famous equation E=mc2 which states that mass can be converted into pure Energy! In 1905 he published four papers on different topics including special Relativistic effects such as time dilation or length contraction; these would later become known collectively under what we now call â€œtheory.â€ The Nobel Prize committee awarded him their prestigious award for this contribution towards science â€“ but not before they had tried unsuccessfully several times over many years due largely because there were no other candidates available at all during those periods when nominations could still happenâ€¦

```
text = """
í•˜ë£¨ ìš°ë¼ë¼
ì´ ì¹´ë“œëª…ì˜ íš¨ê³¼ëŠ” 1í„´ì— 1ë²ˆë°–ì— ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.
â‘ : ì´í•˜ì˜ ì–´ëŠ íš¨ê³¼ë¥¼ í¬í•¨í•˜ëŠ” ë§ˆë²• / í•¨ì • / ëª¬ìŠ¤í„°ì˜ íš¨ê³¼ê°€ ë°œë™í–ˆì„ ë•Œ, ì´ ì¹´ë“œë¥¼ íŒ¨ì—ì„œ ë²„ë¦¬ê³  ë°œë™í•  ìˆ˜ ìˆë‹¤. ê·¸ íš¨ê³¼ë¥¼ ë¬´íš¨ë¡œ í•œë‹¤.
â—ë±ì—ì„œ ì¹´ë“œë¥¼ íŒ¨ì— ë„£ëŠ” íš¨ê³¼
â—ë±ì—ì„œ ëª¬ìŠ¤í„°ë¥¼ íŠ¹ìˆ˜ ì†Œí™˜í•˜ëŠ” íš¨ê³¼
â—ë±ì—ì„œ ì¹´ë“œë¥¼ ë¬˜ì§€ë¡œ ë³´ë‚´ëŠ” íš¨ê³¼

ì´ ì¹´ë“œëŠ” ìì‹  í„´ / ìƒëŒ€ í„´ ìƒê´€ì—†ì´ íŒ¨ì—ì„œ íš¨ê³¼ë¥¼ ë°œë™í•´ì„œ ìƒëŒ€ë¥¼ ê²¬ì œí•  ìˆ˜ ìˆëŠ” íŒ¨íŠ¸ë©ì…ë‹ˆë‹¤.
ë±ì—ì„œ ì¹´ë“œë¥¼ íŒ¨ì— ë„£ê±°ë‚˜, ë¬˜ì§€ë¡œ ë³´ë‚´ê±°ë‚˜, ëª¬ìŠ¤í„°ë¥¼ íŠ¹ìˆ˜ ì†Œí™˜í•˜ëŠ” íš¨ê³¼ë¥¼ ë¬´íš¨í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì´ ì¹´ë“œì˜ í…ìŠ¤íŠ¸ì—ì„œ ê°€ì¥ ì£¼ì˜í•´ì•¼ í•˜ëŠ” ë¶€ë¶„ì€ 'ì´í•˜ì˜ ì–´ëŠ íš¨ê³¼ë¥¼ í¬í•¨í•˜ëŠ”'ì˜ ì„œìˆ ì…ë‹ˆë‹¤.
í…ìŠ¤íŠ¸ ì–´ë”˜ê°€ì— ì € ì„¸ ê°€ì§€ íš¨ê³¼ ê°€ìš´ë° í•˜ë‚˜ë¼ë„ í¬í•¨ì´ ë˜ì—ˆë‹¤ë©´ ë¬´íš¨í™”ê°€ ê°€ëŠ¥í•˜ë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤.

ê°œê¸°ì¼ì‹ì˜ ì„œ
ì†ê³µ ë§ˆë²•
â‘ : í•„ë“œì˜ ì•ë©´ í‘œì‹œ ëª¬ìŠ¤í„°ë¥¼ ì „ë¶€ ë’·ë©´ ìˆ˜ë¹„ í‘œì‹œë¡œ í•œë‹¤. ì´ í„´ì˜ ì—”ë“œ í˜ì´ì¦ˆì—, ìƒëŒ€ í•„ë“œì˜ ë’·ë©´ ìˆ˜ë¹„ í‘œì‹œ ëª¬ìŠ¤í„°ë¥¼ ì „ë¶€ ì•ë©´ ìˆ˜ë¹„ í‘œì‹œë¡œ í•˜ê³ , ê·¸ í›„, ì´ íš¨ê³¼ë¡œ ì•ë©´ ìˆ˜ë¹„ í‘œì‹œë¡œ í•œ ëª¬ìŠ¤í„°ì˜ ìˆ˜ë§Œí¼ ìƒëŒ€ëŠ” ë±ì—ì„œ ë“œë¡œìš°í•œë‹¤.


Q:ìƒëŒ€ê°€ ê°œê¸°ì¼ì‹ì˜ ì„œë¥¼ ë°œë™í–ˆìŠµë‹ˆë‹¤. ê°œê¸°ì¼ì‹ì˜ ì„œì˜ íš¨ê³¼ì— ì²´ì¸í•˜ì—¬ í•˜ë£¨ ìš°ë¼ë¼ë¥¼ ë°œë™í•˜ì—¬ ìƒëŒ€ì˜ íš¨ê³¼ë¥¼ ë¬´íš¨í™” ìˆ˜ ìˆì„ê¹Œìš”?"""

messages = [
    {"role": "user", "content": f"{text}"},
]
inputs = tokenizer.apply_chat_template(messages, return_tensors="pt").cuda()


output = model.generate(inputs,
                        streamer=TextStreamer(tokenizer),
                        max_new_tokens=1024,
                        # pad_token_id=tokenizer.eos_token_id,
                        # repetition_penalty=1.4,
                        temperature=0.01)

print(tokenizer.decode(output[0]))
```

\[ANS\] ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.

ê°œê¸°ì¼ì‹ì˜ ì„œì˜ íš¨ê³¼ëŠ” ë±ì—ì„œ ì¹´ë“œë¥¼ íŒ¨ì— ë„£ëŠ” íš¨ê³¼, ë±ì—ì„œ ëª¬ìŠ¤í„°ë¥¼ íŠ¹ìˆ˜ ì†Œí™˜í•˜ëŠ” íš¨ê³¼, ë±ì—ì„œ ì¹´ë“œë¥¼ ë¬˜ì§€ë¡œ ë³´ë‚´ëŠ” íš¨ê³¼ë¥¼ í¬í•¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

ë”°ë¼ì„œ í•˜ë£¨ ìš°ë¼ë¼ì˜ íš¨ê³¼ë¥¼ ë°œë™í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

\[/ANS\]
